<!doctype html>
<html lang="da">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Flow – Kvittering</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f6f6f4;
  --card:#ffffff;
  --text:#111827;
  --muted:#6b7280;
  --border:#e5e7eb;
  --shadow:0 22px 52px rgba(15,23,42,.14);
  --accent:#10b981;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  min-height:100vh;
}

.container{
  display:flex;
  min-height:100vh;
}

/* Left section - Main card */
.left{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:24px;
  padding:64px 24px;
  transition:all 0.3s ease;
}

.left.shifted{
  flex:0 0 69.625%;
}

.card,
.brand,
.foot{
  width:432px;
  max-width:100%;
}

.brand{
  display:flex;
  align-items:center;
  gap:12px;
  color:var(--muted);
  font-size:15px;
  font-weight:500;
}
.brand__logo{
  width:40px;
  height:40px;
  border-radius:999px;
  background:#fff;
  border:1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}
.brand__logo img{width:28px;height:auto}

.card{
  background:var(--card);
  border-radius:12px;
  box-shadow:var(--shadow);
  padding:48px 36px 46px;
}

.top{text-align:center}

.receipt-icon{
  width:64px;
  height:64px;
  margin:0 auto 16px;
  position:relative;
}
.receipt-icon svg{
  width:100%;
  height:100%;
  color:var(--border);
}
.receipt-icon .checkmark{
  position:absolute;
  bottom:-4px;
  right:-4px;
  width:24px;
  height:24px;
  background:var(--accent);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
}
.receipt-icon .checkmark svg{
  width:14px;
  height:14px;
  color:#fff;
}

.status{
  font-size:14px;
  color:var(--muted);
  margin-bottom:10px;
}
.amount{
  font-size:48px;
  font-weight:700;
  letter-spacing:-.03em;
  margin:16px 0 20px;
}

.toggle{
  background:none;
  border:0;
  color:var(--muted);
  font-size:14px;
  display:inline-flex;
  align-items:center;
  gap:8px;
  cursor:pointer;
  margin-bottom:18px;
  padding:8px 16px;
  border-radius:6px;
  transition:background 0.2s;
}
.toggle:hover{
  background:rgba(0,0,0,0.05);
}
.toggle .arrow{
  transition:transform 0.3s;
}
.toggle.open .arrow{
  transform:rotate(90deg);
}

.rows{
  display:grid;
  grid-template-columns:1fr auto;
  gap:12px 18px;
  margin-top:26px;
  font-size:14px;
}
.k{color:var(--muted)}
.v{font-weight:500;text-align:right}

.actions{
  display:flex;
  gap:12px;
  margin-top:34px;
}
.btn{
  flex:1;
  padding:14px 14px;
  border-radius:8px;
  font-size:14px;
  font-weight:500;
  text-align:center;
  cursor:pointer;
  transition:all 0.2s;
  border:none;
}
.btn--outline{
  background:transparent;
  border:1px solid #d1d5db;
}
.btn--outline:hover{
  background:rgba(0,0,0,0.03);
}
.btn--solid{
  background:#111827;
  color:#fff;
}
.btn--solid:hover{
  background:#1f2937;
}

.foot{
  text-align:center;
  color:var(--muted);
  font-size:13px;
}

/* Right section - Details panel */
.right{
  width:0;
  overflow:hidden;
  background:#fff;
  border-left:1px solid var(--border);
  transition:width 0.3s ease;
  display:flex;
  flex-direction:column;
}

.right.open{
  width:30.375%;
}

.panel-content{
  padding:32px 40px;
  overflow-y:auto;
  flex:1;
  min-width:400px;
}

.panel-close{
  display:flex;
  align-items:center;
  gap:8px;
  color:var(--muted);
  font-size:14px;
  cursor:pointer;
  margin-bottom:32px;
  background:none;
  border:none;
  padding:0;
}
.panel-close:hover{
  color:var(--text);
}

.panel-title{
  font-size:32px;
  font-weight:700;
  margin-bottom:40px;
  letter-spacing:-0.02em;
}

.section-title{
  font-size:11px;
  font-weight:600;
  text-transform:uppercase;
  letter-spacing:0.05em;
  color:var(--muted);
  margin-bottom:16px;
  margin-top:32px;
}
.section-title:first-of-type{
  margin-top:0;
}

.detail-rows{
  display:grid;
  grid-template-columns:100px 1fr;
  gap:12px 24px;
  font-size:14px;
}
.detail-rows .label{
  color:var(--muted);
}
.detail-rows .value{
  color:var(--text);
}
.detail-rows .value a{
  color:#2563eb;
  text-decoration:none;
}
.detail-rows .value a:hover{
  text-decoration:underline;
}

.items-period{
  font-size:11px;
  font-weight:600;
  text-transform:uppercase;
  letter-spacing:0.03em;
  color:var(--muted);
  margin-bottom:12px;
  margin-top:24px;
}

.item-row{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  padding:8px 0;
}
.item-row .item-name{
  color:var(--text);
}
.item-row .item-qty{
  color:var(--muted);
  font-size:12px;
}
.item-row .item-price{
  font-weight:500;
}
.item-row.negative .item-price{
  color:var(--muted);
}

.divider{
  height:1px;
  background:var(--border);
  margin:16px 0;
}

.total-row{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  padding:8px 0;
}
.total-row .total-label{
  color:var(--text);
}
.total-row .total-value{
  font-weight:600;
}
.total-row.muted .total-label,
.total-row.muted .total-value{
  color:var(--muted);
  font-weight:400;
}

.contact-link{
  margin-top:40px;
  padding-top:24px;
  border-top:1px solid var(--border);
  font-size:14px;
  color:var(--muted);
}
.contact-link a{
  color:#2563eb;
  text-decoration:none;
}
.contact-link a:hover{
  text-decoration:underline;
}

/* Mobile responsive */
@media (max-width:900px){
  .container{
    flex-direction:column;
  }
  .left{
    padding:40px 20px;
  }
  .left.shifted{
    flex:none;
  }
  .right{
    width:100%;
    border-left:none;
    border-top:1px solid var(--border);
    height:0;
  }
  .right.open{
    width:100%;
    height:auto;
  }
  .panel-content{
    min-width:auto;
    padding:24px 20px;
  }
  .card{
    padding:32px 24px;
  }
  .amount{
    font-size:36px;
  }
}
</style>
</head>
<body>
<div class="container">
  <section class="left" id="leftSection">
    <header class="brand">
      <div class="brand__logo"><img src="images/FLOW-logo-sort-4K.png" alt="Flow"></div>
      <div>Flow</div>
    </header>

    <div class="card">
      <div class="top">
        <div class="receipt-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          <div class="checkmark">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
              <path d="M5 13l4 4L19 7"/>
            </svg>
          </div>
        </div>
        <div class="status">Faktura betalt</div>
        <div class="amount" id="displayAmount">94,09 kr</div>

        <button class="toggle" type="button" id="toggleBtn" onclick="toggleDetails()">
          <span id="toggleText">Vis fakturaoplysninger</span>
          <span class="arrow" aria-hidden="true">›</span>
        </button>
      </div>

      <div class="rows">
        <div class="k">Fakturanr.</div><div class="v" id="invoiceNumber">A0NLQW06-0008</div>
        <div class="k">Betalingsdato</div><div class="v" id="paymentDate">29. december 2025</div>
        <div class="k">Betalingsmetode</div><div class="v" id="paymentMethod">Visa •••• 5844</div>
      </div>

      <div class="actions">
        <button class="btn btn--outline" onclick="downloadInvoice()">Download faktura</button>
        <button class="btn btn--solid" onclick="downloadReceipt()">Download kvittering</button>
      </div>
    </div>

    <footer class="foot">
      <div>Powered by Flow</div>
    </footer>
  </section>

  <section class="right" id="rightPanel">
    <div class="panel-content">
      <button class="panel-close" onclick="toggleDetails()">
        <span>×</span>
        <span>Luk fakturaoplysninger</span>
      </button>

      <h1 class="panel-title" id="panelTitle">Betalt den 29. dec. 2025</h1>

      <div class="section-title">OVERSIGT</div>
      <div class="detail-rows">
        <div class="label">Til</div>
        <div class="value" id="customerEmail">kunde@email.com</div>
        <div class="label">Fra</div>
        <div class="value" id="restaurantName">Restaurant Navn</div>
        <div class="label">Faktura</div>
        <div class="value" id="invoiceRef">#A0NLQW06-0008</div>
        <div class="label">Memo</div>
        <div class="value" id="memo">Tak for din bestilling!</div>
      </div>

      <div class="section-title">VARER</div>
      <div id="itemsList">
        <!-- Items will be populated by JavaScript -->
      </div>

      <div class="divider"></div>

      <div class="total-row">
        <span class="total-label">Subtotal</span>
        <span class="total-value" id="subtotal">75,27 kr</span>
      </div>
      <div class="total-row">
        <span class="total-label">Total eksklusiv moms</span>
        <span class="total-value" id="totalExVat">75,27 kr</span>
      </div>
      <div class="total-row muted">
        <span class="total-label">Moms (25 %)</span>
        <span class="total-value" id="vatAmount">18,82 kr</span>
      </div>

      <div class="contact-link">
        Spørgsmål? <a href="#" id="contactLink">Kontakt os</a>
      </div>
    </div>
  </section>
</div>

<script>
// Toggle details panel
function toggleDetails() {
  const leftSection = document.getElementById('leftSection');
  const rightPanel = document.getElementById('rightPanel');
  const toggleBtn = document.getElementById('toggleBtn');
  const toggleText = document.getElementById('toggleText');

  const isOpen = rightPanel.classList.contains('open');

  if (isOpen) {
    rightPanel.classList.remove('open');
    leftSection.classList.remove('shifted');
    toggleBtn.classList.remove('open');
    toggleText.textContent = 'Vis fakturaoplysninger';
  } else {
    rightPanel.classList.add('open');
    leftSection.classList.add('shifted');
    toggleBtn.classList.add('open');
    toggleText.textContent = 'Luk fakturaoplysninger';
  }
}

// Format amount with currency
function formatAmount(amount, currency = 'kr') {
  const normalized = currency === 'DKK' ? 'kr' : currency;
  return amount.toLocaleString('da-DK', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' ' + normalized;
}

// Format date in Danish
function formatDate(dateStr) {
  const date = new Date(dateStr);
  const months = ['januar', 'februar', 'marts', 'april', 'maj', 'juni', 'juli', 'august', 'september', 'oktober', 'november', 'december'];
  return `${date.getDate()}. ${months[date.getMonth()]} ${date.getFullYear()}`;
}

// Format short date
function formatShortDate(dateStr) {
  const date = new Date(dateStr);
  const months = ['jan', 'feb', 'mar', 'apr', 'maj', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec'];
  return `${date.getDate()}. ${months[date.getMonth()]}. ${date.getFullYear()}`;
}

// Load order data from URL parameters
function loadOrderData() {
  const params = new URLSearchParams(window.location.search);

  // Get parameters
  const order = params.get('order') || 'A0NLQW06-0008';
  const amount = parseFloat(params.get('amount')) || 94.09;
  const date = params.get('date') || new Date().toISOString().split('T')[0];
  const method = params.get('method') || 'visa';
  const last4 = params.get('last4') || '5844';
  const customer = params.get('customer') || 'kunde@email.com';
  const restaurant = params.get('restaurant') || 'Flow Restaurant';
  const itemsParam = params.get('items') || '';
  const currency = params.get('currency') || 'kr';
  const vatRate = parseFloat(params.get('vat')) || 25;

  // Update card
  document.getElementById('displayAmount').textContent = formatAmount(amount, currency);
  document.getElementById('invoiceNumber').textContent = order;
  document.getElementById('paymentDate').textContent = formatDate(date);
  document.getElementById('paymentMethod').textContent = method.charAt(0).toUpperCase() + method.slice(1) + ' •••• ' + last4;

  // Update panel
  document.getElementById('panelTitle').textContent = 'Betalt den ' + formatShortDate(date);
  document.getElementById('customerEmail').textContent = customer;
  document.getElementById('restaurantName').textContent = restaurant;
  document.getElementById('invoiceRef').textContent = '#' + order;

  // Parse and display items
  const itemsList = document.getElementById('itemsList');
  itemsList.innerHTML = '';

  let subtotal = 0;
  const itemsArray = [];

  if (itemsParam) {
    const items = itemsParam.split(',');
    items.forEach(item => {
      const [name, price] = item.split(':');
      const priceNum = parseFloat(price);
      subtotal += priceNum;
      itemsArray.push({
        name: decodeURIComponent(name),
        price: priceNum,
        qty: 1
      });

      const itemRow = document.createElement('div');
      itemRow.className = 'item-row' + (priceNum < 0 ? ' negative' : '');
      itemRow.innerHTML = `
        <div>
          <span class="item-name">${decodeURIComponent(name)}</span>
          <div class="item-qty">Antal 1</div>
        </div>
        <span class="item-price">${formatAmount(priceNum, currency)}</span>
      `;
      itemsList.appendChild(itemRow);
    });
  } else {
    // Default items if none provided
    subtotal = amount / (1 + vatRate/100);
    itemsArray.push({
      name: 'Bestilling',
      price: subtotal,
      qty: 1
    });
    const itemRow = document.createElement('div');
    itemRow.className = 'item-row';
    itemRow.innerHTML = `
      <div>
        <span class="item-name">Bestilling</span>
        <div class="item-qty">Antal 1</div>
      </div>
      <span class="item-price">${formatAmount(subtotal, currency)}</span>
    `;
    itemsList.appendChild(itemRow);
  }

  // Calculate totals
  const totalExVat = subtotal;
  const vatAmount = subtotal * (vatRate / 100);

  document.getElementById('subtotal').textContent = formatAmount(subtotal, currency);
  document.getElementById('totalExVat').textContent = formatAmount(totalExVat, currency);
  document.getElementById('vatAmount').textContent = formatAmount(vatAmount, currency);

  // Store data for download functions
  window.orderData = {
    order, amount, date, method, last4, customer, restaurant, currency, vatRate, subtotal, vatAmount,
    items: itemsArray
  };
}

function escapePdfText(text) {
  return String(text).replace(/\\/g, '\\\\').replace(/\(/g, '\\(').replace(/\)/g, '\\)');
}

function buildPdf(contentStream) {
  const objects = [];
  const offsets = [];

  const addObject = (obj) => {
    offsets.push(objects.join('').length);
    objects.push(obj);
  };

  addObject('1 0 obj << /Type /Catalog /Pages 2 0 R >> endobj\n');
  addObject('2 0 obj << /Type /Pages /Kids [3 0 R] /Count 1 >> endobj\n');
  addObject('3 0 obj << /Type /Page /Parent 2 0 R /MediaBox [0 0 595 842] /Contents 4 0 R /Resources << /Font << /F1 5 0 R >> >> >> endobj\n');
  addObject(`4 0 obj << /Length ${contentStream.length} >> stream\n${contentStream}\nendstream\nendobj\n`);
  addObject('5 0 obj << /Type /Font /Subtype /Type1 /BaseFont /Helvetica >> endobj\n');

  const xrefStart = objects.join('').length;
  let xref = 'xref\n0 6\n0000000000 65535 f \n';
  offsets.forEach((offset) => {
    xref += `${String(offset).padStart(10, '0')} 00000 n \n`;
  });
  const trailer = `trailer << /Size 6 /Root 1 0 R >>\nstartxref\n${xrefStart}\n%%EOF`;

  return `%PDF-1.3\n${objects.join('')}${xref}${trailer}`;
}

function downloadPdf(filename, contentStream) {
  const pdf = buildPdf(contentStream);
  const blob = new Blob([pdf], { type: 'application/pdf' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

function buildPdfFromOrder(kind) {
  const data = window.orderData || {};
  const title = kind === 'invoice' ? 'Faktura' : 'Kvittering';
  const commands = [];
  const pageWidth = 595;
  const left = 50;
  const right = pageWidth - 50;
  let y = 790;

  const addText = (text, x, yPos, size = 12, color = '0 0 0') => {
    commands.push(`${color} rg`);
    commands.push(`BT /F1 ${size} Tf 1 0 0 1 ${x} ${yPos} Tm (${escapePdfText(text)}) Tj ET`);
  };
  const addLine = (x1, y1, x2, y2, color = '0.9 0.9 0.9') => {
    commands.push(`${color} RG`);
    commands.push('1 w');
    commands.push(`${x1} ${y1} m ${x2} ${y2} l S`);
  };

  addText(`${title} – Flow`, left, y, 20);
  y -= 22;
  addText(`Ordre: ${data.order || '-'}`, left, y, 11, '0.4 0.4 0.4');
  y -= 16;
  addText(`Dato: ${data.date ? formatDate(data.date) : '-'}`, left, y, 11, '0.4 0.4 0.4');
  y -= 22;
  addLine(left, y, right, y);
  y -= 24;

  addText('OVERSIGT', left, y, 11, '0.4 0.4 0.4');
  y -= 18;
  const labelX = left;
  const valueX = 220;
  addText('Til', labelX, y);
  addText(data.customer || '-', valueX, y);
  y -= 16;
  addText('Fra', labelX, y);
  addText(data.restaurant || '-', valueX, y);
  y -= 16;
  addText('Faktura', labelX, y);
  addText(`#${data.order || '-'}`, valueX, y);
  y -= 16;
  addText('Betalingsmetode', labelX, y);
  addText(`${data.method ? data.method.charAt(0).toUpperCase() + data.method.slice(1) : '-'} •••• ${data.last4 || '-'}`, valueX, y);
  y -= 24;

  addText('VARER', left, y, 11, '0.4 0.4 0.4');
  y -= 18;
  const items = data.items || [];
  const priceX = right - 40;
  items.forEach((item) => {
    addText(item.name || '-', left, y);
    addText(`Antal ${item.qty || 1}`, left, y - 12, 10, '0.4 0.4 0.4');
    addText(formatAmount(item.price || 0, data.currency), priceX, y);
    y -= 28;
  });
  if (!items.length) {
    addText('Bestilling', left, y);
    addText('Antal 1', left, y - 12, 10, '0.4 0.4 0.4');
    addText(formatAmount(data.subtotal || 0, data.currency), priceX, y);
    y -= 28;
  }

  addLine(left, y, right, y);
  y -= 20;
  addText('Subtotal', right - 180, y);
  addText(formatAmount(data.subtotal || 0, data.currency), right - 40, y);
  y -= 16;
  addText('Total ekskl. moms', right - 180, y, 12, '0.4 0.4 0.4');
  addText(formatAmount(data.subtotal || 0, data.currency), right - 40, y, 12, '0.4 0.4 0.4');
  y -= 16;
  addText(`Moms (${data.vatRate || 25}%)`, right - 180, y, 12, '0.4 0.4 0.4');
  addText(formatAmount(data.vatAmount || 0, data.currency), right - 40, y, 12, '0.4 0.4 0.4');
  y -= 22;
  addText('Total', right - 180, y, 12);
  addText(formatAmount(data.amount || 0, data.currency), right - 40, y, 12);

  return commands.join('\n');
}

function downloadInvoice() {
  const contentStream = buildPdfFromOrder('invoice');
  downloadPdf(`faktura-${window.orderData?.order || 'order'}.pdf`, contentStream);
}

function downloadReceipt() {
  const contentStream = buildPdfFromOrder('receipt');
  downloadPdf(`kvittering-${window.orderData?.order || 'order'}.pdf`, contentStream);
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', loadOrderData);
</script>
</body>
</html>
